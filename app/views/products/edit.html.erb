<%# app/views/products/edit.html.erb %>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetailBuddy - Edit Product</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
</head>
<body style="margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; background-color: #1e1e2e; color: #f8f9fa;">
    <div style="max-width: 700px; margin: 2rem auto; padding: 2rem; background-color: #282a36; border-radius: 12px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); border: 1px solid #44475a;">
        <h1 style="font-size: 1.75rem; margin-bottom: 1.5rem; font-weight: 600; color: #f8f9fa; border-bottom: 1px solid #44475a; padding-bottom: 1rem;">Edit Product</h1>

        <%= form_with(model: @product, local: true) do |form| %>
            <% if @product.errors.any? %>
                 <div style="color: #f8f9fa; background-color: #5e3a3a; border: 1px solid #f44336; padding: 1rem 1.25rem; margin-bottom: 1.5rem; border-radius: 8px;">
                    <h2 style="margin-top: 0; margin-bottom: 0.25rem; font-weight: bold; font-size: 1rem; color: #f44336;"><%= pluralize(@product.errors.count, "error") %> prohibited this product from being saved:</h2>
                    <ul style="margin-left: 1.25rem; margin-bottom: 0; font-size: 0.875rem; list-style: disc; padding-left: 1rem;">
                        <% @product.errors.full_messages.each do |message| %>
                            <li><%= message %></li>
                        <% end %>
                    </ul>
                </div>
            <% end %>

            <%# --- Product Fields --- %>
            <div style="margin-bottom: 1.25rem;">
                <%= form.label :name, "Product Name", style: "display: block; margin-bottom: 4px; font-size: 14px; color: #bdc1c6; font-weight: 500;" %>
                <%= form.text_field :name, style: "display: block; width: 100%; padding: 12px 15px; background-color: #44475a; color: #f8f9fa; border: 1px solid #44475a; border-radius: 8px; line-height: normal; box-sizing: border-box; margin-top: 0.25rem; height: calc(1.5em + 24px + 2px);" %>
            </div>

            <div style="margin-bottom: 1.25rem;">
                 <%= form.label :category_id, style: "display: block; margin-bottom: 4px; font-size: 14px; color: #bdc1c6; font-weight: 500;" %>
                <%= form.collection_select :category_id, @categories, :id, :name, { prompt: 'Select a Category' }, { style: "display: block; width: 100%; padding: 12px 15px; background-color: #44475a; color: #bdc1c6; border: 1px solid #44475a; border-radius: 8px; line-height: normal; box-sizing: border-box; margin-top: 0.25rem; height: calc(1.5em + 24px + 2px); appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"%23bdc1c6\"><path fill-rule=\"evenodd\" d=\"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z\" clip-rule=\"evenodd\" /></svg>'); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1.25em 1.25em; padding-right: 2.5rem;" } %>
            </div>

            <div style="margin-bottom: 1.25rem;">
                <%= form.label :price, style: "display: block; margin-bottom: 4px; font-size: 14px; color: #bdc1c6; font-weight: 500;" %>
                <%= form.number_field :price, step: '0.01', style: "display: block; width: 100%; padding: 12px 15px; background-color: #44475a; color: #f8f9fa; border: 1px solid #44475a; border-radius: 8px; line-height: normal; box-sizing: border-box; margin-top: 0.25rem; height: calc(1.5em + 24px + 2px);" %>
            </div>

            <%# === Stock Quantity field (belongs to Product) === %>
            <div style="margin-bottom: 1.25rem;">
                <%= form.label :stock_quantity, "Stock Quantity (Product)", style: "display: block; margin-bottom: 4px; font-size: 14px; color: #bdc1c6; font-weight: 500;" %>
                <%= form.number_field :stock_quantity, min: 0, style: "display: block; width: 100%; padding: 12px 15px; background-color: #44475a; color: #f8f9fa; border: 1px solid #44475a; border-radius: 8px; line-height: normal; box-sizing: border-box; margin-top: 0.25rem; height: calc(1.5em + 24px + 2px);" %>
            </div>
            <%# === End Stock Quantity === %>

            <hr style="border: none; border-top: 1px solid #44475a; margin-top: 1.5rem; margin-bottom: 1.5rem;">
            <h2 style="font-size: 1.125rem; margin-bottom: 1rem; font-weight: 600; color: #f8f9fa;">Inventory Metadata</h2>

            <%# --- Nested INVENTORY Metadata fields --- %>
            <%= form.fields_for :inventory, (@product.inventory || @product.build_inventory) do |inventory_form| %>
                <div style="margin-bottom: 1.25rem;">
                     <%= inventory_form.label :warehouse_location, style: "display: block; margin-bottom: 4px; font-size: 14px; color: #bdc1c6; font-weight: 500;" %>
                    <%= inventory_form.text_field :warehouse_location, style: "display: block; width: 100%; padding: 12px 15px; background-color: #44475a; color: #f8f9fa; border: 1px solid #44475a; border-radius: 8px; line-height: normal; box-sizing: border-box; margin-top: 0.25rem; height: calc(1.5em + 24px + 2px);" %>
                </div>
                <div style="margin-bottom: 1.25rem;">
                    <%= inventory_form.label :reorder_level, style: "display: block; margin-bottom: 4px; font-size: 14px; color: #bdc1c6; font-weight: 500;" %>
                    <%= inventory_form.number_field :reorder_level, min: 0, style: "display: block; width: 100%; padding: 12px 15px; background-color: #44475a; color: #f8f9fa; border: 1px solid #44475a; border-radius: 8px; line-height: normal; box-sizing: border-box; margin-top: 0.25rem; height: calc(1.5em + 24px + 2px);" %>
                </div>
            <% end %>
            <%# --- End Inventory Metadata Fields --- %>

            <div style="margin-top: 2rem; display: flex; gap: 0.75rem; justify-content: flex-end;">
                <%= form.submit "Update Product", style: "display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem 1rem; border: 1px solid transparent; font-size: 0.875rem; font-weight: 500; border-radius: 8px; cursor: pointer; text-decoration: none !important; color: white; background-color: #6c63ff; border-color: #6c63ff; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);" %>
                <%= link_to "Cancel", inventory_path, style: "display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem 1rem; border: 1px solid #44475a; font-size: 0.875rem; font-weight: 500; border-radius: 8px; cursor: pointer; text-decoration: none !important; color: #f8f9fa; background-color: #44475a; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);" %>
            </div>
        <% end %>
    </div>
</body>
</html>