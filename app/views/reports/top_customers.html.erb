<%# app/views/reports/top_customers.html.erb %>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetailBuddy - Top Customers Report</title>

    <%# Standard Rails head tags %>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%# Link necessary CSS - Assuming standalone page structure & no application/custom links %>
    <%# <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "dashboard", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "reports", "data-turbo-track": "reload" %>
    <%# <%= stylesheet_link_tag "custom", "data-turbo-track": "reload" %>

    <%# JavaScript include %>
    <%= javascript_importmap_tags %>

    <%# Font Awesome link %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <%# Inline Styles for consistency (mimicking other reports) %>
    <style>
      /* --- Base Variables --- */
      :root {
        --primary-color: #6c63ff; --secondary-color: #4d44d9; --accent-color: #50fa7b; --text-color: #f8f9fa; --text-secondary: #bdc1c6; --bg-color: #1e1e2e; --card-bg: #282a36; --card-hover: #3a3c4e; --input-bg: #44475a; --shadow-color: rgba(0, 0, 0, 0.3); --border-color: #44475a; --border-radius-sm: 6px; --border-radius-md: 10px; --button-bg: #44475a; --button-hover-bg: #5a5c72; --link-color: #8be9fd; --error-color: #f44336;
      }
      /* --- Basic Body/Container --- */
      body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Poppins', sans-serif; line-height: 1.5; font-size: 14px; margin: 0; }
      .dashboard-content { padding: 1.5rem; max-width: 1100px; margin: 0 auto; width: 100%; }
      /* --- Header --- */
      .reports-header { margin-bottom: 1rem; padding-bottom: 0.8rem; border-bottom: 1px solid var(--border-color); display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; }
      .reports-title { font-size: 1.2rem; font-weight: 600; color: var(--text-color); margin-bottom: 0; }
      .reports-header .text-secondary.small { margin-bottom: 0; font-size: 0.85em; }
      /* --- Date Controls Area --- */
      .date-controls-container { display: flex; flex-wrap: wrap; align-items: center; justify-content: flex-start; gap: 1rem 1.5rem; margin-top: 1rem; margin-bottom: 1.5rem; }

      /* --- Date Links & Form Elements (Alignment Fix Applied) --- */
      .date-link-group a,
      .date-picker-form button,
      .date-picker-form input[type="submit"],
      .back-link a {
        display: inline-flex; align-items: center;
        padding: 0.3rem 0.5rem; /* Consistent padding */
        font-size: 0.8rem; margin-right: 0.5rem; margin-bottom: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); color: var(--text-secondary); background-color: var(--button-bg); text-decoration: none; cursor: pointer;
        line-height: 1.4; /* Consistent line-height */
        transition: background-color 0.2s ease, color 0.2s ease; white-space: nowrap; appearance: none; -webkit-appearance: none; font-family: inherit;
        vertical-align: middle; /* <<< ADDED alignment */
      }
      .date-link-group a:hover,
      .date-picker-form button:hover,
      .date-picker-form input[type="submit"]:hover,
      .back-link a:hover { background-color: var(--button-hover-bg); color: var(--text-color); border-color: var(--border-color); }

      /* Form Container - Use align-items: center */
      .date-picker-form {
          display: flex;
          align-items: baseline; /* Use center alignment for the container */
          gap: 0.6rem;
          margin-bottom: 0.5rem;
      }
      .date-picker-form label {
          font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0; white-space: nowrap;
          vertical-align: middle; /* <<< ADDED alignment */
       }
      .date-picker-form input[type="date"] {
          padding: 0.3rem 0.5rem; /* Consistent padding */
          font-size: 0.8rem; border: 1px solid var(--border-color); background-color: var(--input-bg); color: var(--text-color); border-radius: var(--border-radius-sm); max-width: 140px;
          line-height: 1.4; /* Consistent line-height */
          appearance: none; -webkit-appearance: none;
          vertical-align: middle; /* <<< ADDED alignment */
       }
       .date-picker-form input[type="date"]::-webkit-calendar-picker-indicator { background-color: var(--text-secondary); padding: 3px; border-radius: 3px; cursor: pointer; filter: invert(1); margin-left: 3px;}
      /* Submit button inherits base styles */

      /* --- Flash Messages --- */
      .alert { padding: 0.75rem 1rem; margin-bottom: 1.5rem; border: 1px solid transparent; border-radius: var(--border-radius-sm); font-size: 0.9em;}
      .alert-danger { color: var(--error-color); background-color: rgba(244, 67, 54, 0.1); border-color: rgba(244, 67, 54, 0.3); }
      /* --- Tables --- */
      .report-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; margin-top: 0.8rem; margin-bottom: 1rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); overflow: hidden; }
      .report-table th, .report-table td { padding: 0.6rem 0.8rem; text-align: left; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
      .report-table th { color: var(--text-secondary); font-weight: 600; background-color: var(--card-hover); white-space: nowrap; border-bottom: 2px solid var(--border-color); }
      .report-table td { color: var(--text-secondary); }
      .report-table td a { color: var(--link-color); text-decoration: none; font-weight: 500; }
      .report-table td a:hover { color: var(--primary-color); text-decoration: underline; }
      .report-table td.numeric { text-align: right; font-family: monospace; }
      .report-table td.customer-id { color: var(--text-color); font-weight: 500; }
      .report-table tbody tr:nth-child(even) { background-color: rgba(0,0,0,0.1); }
      .report-table tbody tr:hover { background-color: var(--card-hover); }
      .report-table tbody tr:last-child td { border-bottom: none; }
      /* --- Utilities --- */
      .fs-6 { font-size: 1rem !important; } .fw-semibold { font-weight: 600 !important; } .mb-3 { margin-bottom: 1rem !important; } .mt-4 { margin-top: 1.5rem !important; } .me-2 { margin-right: 0.5rem !important; } .ms-2 { margin-left: 0.5rem !important; } .small { font-size: .875em; } .text-secondary { color: var(--text-secondary) !important; } .text-muted { color: var(--text-secondary) !important; } .text-center { text-align: center !important; } .py-3 { padding-top: 1rem !important; padding-bottom: 1rem !important; } .table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; margin-bottom: 1rem; }
      hr.my-4 { margin-top: 2rem !important; margin-bottom: 1.5rem !important; border: 0; border-top: 1px solid var(--border-color); opacity: 0.25; }
    </style>

</head>
<body>

    <div class="dashboard-content reports-page-container">

        <div class="reports-header">
            <h1 class="reports-title fs-6 fw-semibold">Top Customers Report</h1>
            <span class="text-secondary small">Period: <%= @start_date.strftime('%b %d, %Y') %> to <%= @end_date.strftime('%b %d, %Y') %></span>
        </div>

        <%# Date Controls Area %>
        <div class="date-controls-container">
            <%# Quick Date Selection Links %>
            <div class="date-link-group">
                <span class="small text-muted me-2">Quick View:</span>
                 <%# Links below should inherit styling from the base rule above %>
                <a href="<%= top_customers_report_path(start_date: Time.zone.now.to_date, end_date: Time.zone.now.to_date) %>">Today</a>
                <a href="<%= top_customers_report_path(start_date: Time.zone.now.beginning_of_week.to_date, end_date: Time.zone.now.to_date) %>">This Week</a>
                <a href="<%= top_customers_report_path(start_date: Time.zone.now.beginning_of_month.to_date, end_date: Time.zone.now.to_date) %>">This Month</a>
                <a href="<%= top_customers_report_path(start_date: Time.zone.now.last_month.beginning_of_month.to_date, end_date: Time.zone.now.last_month.end_of_month.to_date) %>">Last Month</a>
            </div>

            <%# Date Picker Form %>
            <%= form_with(url: top_customers_report_path, method: :get, local: true, class: "date-picker-form") do |form| %>
              <%= form.label :start_date, "From:", class: "small text-muted" %>
              <%= form.date_field :start_date, value: @start_date %>
              <%= form.label :end_date, "To:", class: "small text-muted ms-2" %>
              <%= form.date_field :end_date, value: @end_date %>
              <%= form.submit "Update" %> <%# Button should inherit styling from the base rule above %>
            <% end %>
        </div>

        <%# Flash Messages %>
        <% if flash[:alert] %>
          <div class="alert alert-danger" role="alert">
            <%= flash[:alert] %>
          </div>
        <% end %>

        <%# Top Customers Table %>
        <h3 class="fs-6 fw-semibold mb-3">Top Customers by Revenue</h3>
        <div class="table-responsive">
            <table class="report-table">
                <thead>
                    <tr>
                        <th>Customer ID</th>
                        <th>Customer Name</th>
                        <th class="numeric">Total Revenue</th>
                    </tr>
                </thead>
                <tbody>
                    <% if @top_customers_data.present? %>
                        <% @top_customers_data.each do |data| %>
                            <tr>
                                <td class="customer-id"><%= data.customer_id %></td>
                                <td>
                                  <%= link_to data.customer_name, edit_customer_path(data.customer_id) rescue data.customer_name %>
                                </td>
                                <td class="numeric"><%= number_to_currency(data.total_revenue, unit: '₹') %></td>
                            </tr>
                        <% end %>
                    <% else %>
                         <tr>
                             <td colspan="3" class="text-center text-muted py-3">No customer spending data found for this period.</td>
                         </tr>
                    <% end %>
                </tbody>
            </table>
        </div>

        <%# Back Link %>
        <div class="mt-4 back-link">
             <a href="<%= reports_path %>">← Back to Reports Index</a>
        </div>

    </div> <%# End .dashboard-content %>

</body>
</html>