<%# app/views/reports/sales_by_category.html.erb %>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetailBuddy - Sales by Category Report</title>

    <%# Link essential stylesheets %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "dashboard", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "reports", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "custom", "data-turbo-track": "reload" %>

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= javascript_importmap_tags %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
      .date-link-group a { display: inline-block; padding: 0.3rem 0.6rem; font-size: 0.8rem; margin-right: 0.5rem; margin-bottom: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); color: var(--text-secondary); text-decoration: none; background-color: var(--button-bg); }
      .date-link-group a:hover { background-color: var(--button-hover-bg); color: var(--text-color); }
      .report-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; margin-top: 1rem; }
      .report-table th, .report-table td { padding: 0.6rem 0.8rem; text-align: left; border-bottom: 1px solid var(--border-color); }
      .report-table th { color: var(--text-secondary); font-weight: 500; background-color: rgba(0,0,0,0.1); }
      .report-table td.numeric { text-align: right; }
      .report-table tbody tr:hover { background-color: var(--card-hover); }
      .summary-value { font-size: 1.5em; font-weight: 600; }
      .text-muted { color: var(--text-secondary); }
    </style>
</head>
<body>
    <div class="dashboard-content reports-page-container">

        <div class="reports-header mb-3 pb-2 border-bottom border-secondary d-flex justify-content-between align-items-center">
            <h1 class="reports-title fs-5 fw-semibold">Sales by Category Report</h1>
            <span class="text-secondary small">Period: <%= @start_date.strftime('%b %d, %Y') %> to <%= @end_date.strftime('%b %d, %Y') %></span>
        </div>

        <%# Quick Date Selection Links %>
        <div class="date-link-group mb-4">
            <span class="small text-muted me-2">View:</span>
            <%= link_to "Today", sales_by_category_report_path(start_date: Time.zone.now.to_date, end_date: Time.zone.now.to_date) %>
            <%= link_to "This Week", sales_by_category_report_path(start_date: Time.zone.now.beginning_of_week.to_date, end_date: Time.zone.now.to_date) %>
            <%= link_to "This Month", sales_by_category_report_path(start_date: Time.zone.now.beginning_of_month.to_date, end_date: Time.zone.now.to_date) %>
            <%= link_to "Last Month", sales_by_category_report_path(start_date: Time.zone.now.last_month.beginning_of_month.to_date, end_date: Time.zone.now.last_month.end_of_month.to_date) %>
             <%# Optional custom date form can be added here if desired %>
        </div>

        <%# Display flash messages if any %>
        <% if flash[:alert] %>
          <div class="alert alert-danger small p-2 mb-3" style="background-color: rgba(var(--error-color), 0.1); border: 1px solid rgba(var(--error-color), 0.3); color: var(--error-color); border-radius: var(--border-radius-sm);" role="alert">
            <%= flash[:alert] %>
          </div>
        <% end %>

        <%# Overall Summary for the Period %>
        <div class="row g-3 mb-4">
            <div class="col-md-12">
                 <div class="info-card" style="background-color: var(--card-bg); border-radius: var(--border-radius-md); padding: 1rem 1.2rem; border: 1px solid var(--border-color);">
                     <h3 class="fs-6 fw-medium mb-2" style="color: var(--text-secondary);">Total Revenue (Selected Period)</h3>
                     <p class="summary-value mb-0"><%= number_to_currency(@total_revenue_period, unit: '₹') %></p> <%# Use _period suffix %>
                </div>
            </div>
        </div>

        <%# Detailed Table - Sales by Category %>
        <h3 class="fs-6 fw-semibold mb-3">Revenue Breakdown by Category</h3>
        <div style="overflow-x: auto; background-color: var(--card-bg); border-radius: var(--border-radius-sm); border: 1px solid var(--border-color);">
            <table class="report-table">
                <thead>
                    <tr>
                        <th>Category Name</th>
                        <th class="numeric">Total Revenue</th>
                    </tr>
                </thead>
                <tbody>
                    <% if @sales_by_category_data.present? %>
                        <% @sales_by_category_data.each do |data| %>
                            <tr>
                                <td><%= data.category_name %></td>
                                <td class="numeric"><%= number_to_currency(data.total_revenue, unit: '₹') %></td>
                            </tr>
                        <% end %>
                    <% else %>
                         <tr>
                             <td colspan="2" class="text-center text-muted py-3">No sales data found for this period.</td>
                         </tr>
                    <% end %>
                </tbody>
            </table>
        </div>

        <div style="margin-top: 2rem;">
             <%= link_to "← Back to Reports Index", reports_path, style: "display: inline-block; padding: 0.5rem 1rem; font-size: 0.85rem; border-radius: var(--border-radius-sm); border: 1px solid var(--border-color); color: var(--text-secondary); text-decoration: none; transition: all 0.2s ease; background-color: transparent;" %>
        </div>
    </div>
</body>
</html>