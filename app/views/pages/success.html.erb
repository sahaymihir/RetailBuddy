<%# app/views/pages/success.html.erb %>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetailBuddy Dashboard</title>
    <%# Link stylesheets - ensure these paths are correct for your asset pipeline %>
    <%= stylesheet_link_tag "dashboard", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "custom", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <%# External Fonts/Icons %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <%# Main container for the dashboard layout %>
    <div id="dashboard-container" data-turbo-cache="false">

        <%# Sticky Header %>
        <header class="header">
            <div class="logo-container">
                <%# Link logo to success path %>
                <%= link_to success_path_url, class: "logo" do %>
                  <i class="fas fa-store-alt"></i>
                  <span>RetailBuddy</span>
                <% end %>
            </div>

            <div class="header-controls">
                <%# Display user menu only if a user is logged in %>
                <% if current_user %>
                  <%# REMOVED: data-controller="dropdown" %>
                  <div class="user-menu">
                      <%# Welcome text acts as the dropdown button %>
                      <button id="userButton" class="welcome-user">
                          Welcome, <%= current_user.name %>
                          <i class="fas fa-chevron-down"></i>
                      </button>
                      <%# Dropdown content %>
                      <div id="userDropdown" class="user-dropdown">
                          <%= button_to logout_path, method: :delete, class: "dropdown-item-form" do %>
                              <span class="dropdown-item"> <%# Wrap content for consistent styling %>
                                 <i class="fas fa-sign-out-alt"></i> Logout
                              </span>
                          <% end %>
                          <%# Add other dropdown items here if needed %>
                      </div>
                  </div>
                <% end %>
            </div> <%# End header-controls %>
        </header> <%# End header %>

        <%# Main content area below the header %>
        <main class="dashboard-content">
            <%# ... (Your existing dashboard content sections: top-info, action-buttons, tile-grid) ... %>
             <%# === Top Info Section === %>
            <section class="top-info-section">
                <div class="info-card sales-snapshot">
                    <h3>Sales Snapshot</h3>
                    <p>Today: $123.45</p> <%# Placeholder data %>
                    <p>Week-to-Date: $678.90</p> <%# Placeholder data %>
                    <p>Transactions Today: 15</p> <%# Placeholder data %>
                </div>
                <div class="info-card low-stock-alerts">
                    <h3>Low Stock Alerts</h3>
                    <p>Sample Item 1 (5 left)</p> <%# Placeholder data %>
                    <p>Sample Item 2 (3 left)</p> <%# Placeholder data %>
                    <a href="#">View Full Inventory</a>
                </div>
            </section>

            <%# === Middle Action Buttons Section === %>
            <section class="action-buttons">
                <button class="action-btn">Start New Sale</button>
                <button class="action-btn">Add Product</button>
                <button class="action-btn">View Daily Report</button>
                <button class="action-btn">Add Customer</button>
            </section>

            <%# === Bottom Tile Grid Section === %>
            <section class="tile-grid-section">
                <h2>Core Modules</h2>
                <div class="tile-grid">
                    <a href="<%= new_billing_path %>" class="tile">
                        <div class="tile-icon"><i class="fas fa-file-invoice-dollar"></i></div>
                        <h3>Billing</h3>
                        <p>Manage invoices, process payments, and track your sales.</p>
                    </a>
                    <a href="<%= inventory_path %>" class="tile">
                        <div class="tile-icon"><i class="fas fa-boxes-stacked"></i></div>
                        <h3>Inventory Management</h3>
                        <p>Track stock levels, manage products, and handle suppliers.</p>
                    </a>
                    <a href="<%= reports_path %>" class="tile">
                        <div class="tile-icon"><i class="fas fa-chart-pie"></i></div>
                        <h3>Reports & Analytics</h3>
                        <p>Get insights with detailed reports and visual analytics.</p>
                    </a>
                    <a href="<%= customers_path %>" class="tile">
                        <div class="tile-icon"><i class="fas fa-users"></i></div>
                        <h3>Customers</h3>
                        <p>Manage customer data, loyalty programs, and communications.</p>
                    </a>
                     <a href="<%= help_path %>" class="tile">
                        <div class="tile-icon"><i class="fas fa-headset"></i></div>
                        <h3>Help and Support</h3>
                        <p>Access tutorials, FAQs, and contact support for assistance.</p>
                    </a>
                    <% if current_user && current_user.role == "Admin" %>
                      <a href="<%= admin_users_path %>" class="tile">
                          <div class="tile-icon"><i class="fas fa-user-shield"></i></div>
                          <h3>Admin Panel</h3>
                          <p>Configure system settings and manage user access.</p>
                      </a>
                    <% end %>
                </div>
            </section>
        </main> <%# End dashboard-content %>

    </div> <%# End dashboard-container %>

    <%# ADDED: Inline script for dropdown functionality %>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        const userButton = document.getElementById("userButton");
        const userDropdown = document.getElementById("userDropdown");

        if (userButton && userDropdown) {
          // Function to update chevron
          const updateChevron = () => {
            const chevron = userButton.querySelector(".fa-chevron-down, .fa-chevron-up");
            if (chevron) {
              chevron.className = userDropdown.classList.contains("show")
                ? "fas fa-chevron-up"
                : "fas fa-chevron-down";
            }
          };

          // Toggle dropdown on button click
          userButton.addEventListener("click", function(e) {
            e.preventDefault(); // Prevent potential form submission issues if button is inside form
            e.stopPropagation(); // Prevent click from immediately closing dropdown via document listener
            userDropdown.classList.toggle("show");
            updateChevron();
          });

          // Close dropdown if clicking outside
          document.addEventListener("click", function(e) {
            // Check if the click is outside the button AND outside the dropdown menu
            if (!userButton.contains(e.target) && !userDropdown.contains(e.target)) {
              if (userDropdown.classList.contains("show")) {
                userDropdown.classList.remove("show");
                updateChevron();
              }
            }
          });

          // Prevent clicks inside the dropdown from closing it (optional, usually desired)
          userDropdown.addEventListener("click", function(e) {
            // If the click is on the logout button/form, let it proceed
            if (e.target.closest('.dropdown-item-form')) {
                 return; // Don't stop propagation for logout button
            }
            e.stopPropagation(); // Stop clicks inside dropdown from reaching document listener
          });
        }
      });
    </script>
</body>
</html>