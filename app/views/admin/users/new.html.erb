<!DOCTYPE html>
<html>
<head>
  <title>New Admin User - RetailBuddy</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%# Link required stylesheets %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "dashboard", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "admin", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "custom", "data-turbo-track": "reload" %>

  <%= javascript_importmap_tags %>
</head>
<body>
  <%# --- ASSUMPTION: Shared Header --- %>
  <%# render 'layouts/dashboard_header' %>

  <div class="admin-page-container">

    <%# Page Header: Title and 'Back' Button %>
    <div class="admin-header">
      <h1 class="admin-title"><i class="fas fa-user-plus"></i> Create New User</h1>
      <%= link_to "Back to Users List", admin_users_path, class: "action-btn secondary" %>
    </div>

    <%# Form Container (styled as a card) %>
    <div class="admin-form-card"> <%# Use card style for the form %>
      <h3>Enter User Details</h3>

      <%= form_with(model: [:admin, @user], local: true, html: { class: "admin-form" }) do |form| %>
        <%# Display validation errors if any %>
        <% if @user.errors.any? %>
          <div class="form-errors"> <%# Style error messages box %>
            <h2><%= pluralize(@user.errors.count, "error") %> prohibited this user from being saved:</h2>
             <%# Optional Debug: Shows the user ID if it was unexpectedly present %>
             <%# <p><strong>Debug - UserID causing error (should be nil):</strong> <%= @user.userid.inspect %></p> %>
            <ul>
              <% @user.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <%# Input field for Name %>
        <div class="input-group">
          <%= form.label :name %>
          <%= form.text_field :name, required: true, placeholder: "Enter full name" %>
        </div>

        <%# Dropdown select for Role %>
        <div class="input-group">
          <%= form.label :role %>
           <%# Dynamically get roles from User model validation if possible %>
          <% role_options = User.validators_on(:role).find { |v| v.is_a?(ActiveModel::Validations::InclusionValidator) }&.options&.fetch(:in, ['Admin', 'Employee']) %>
          <%= form.select :role, options_for_select(role_options, @user.role), {prompt: "Select role"}, required: true %>
          <small><i>Email will be auto-generated based on Name and Role.</i></small>
        </div>

        <%# Input field for Password (required for new user) %>
        <div class="input-group">
          <%= form.label :password %>
          <%= form.password_field :password, required: true, placeholder: "Enter initial password" %>
        </div>

        <%# Password confirmation is often good practice, but removed based on previous context %>

        <%# Form action buttons (Create and Cancel) %>
        <div class="form-actions">
          <%= link_to "Cancel", admin_users_path, class: "action-btn secondary" %>
          <%= form.submit "Create User", class: "action-btn primary" %>
        </div>
      <% end %>
    </div> <%# End admin-form-card %>

  </div> <%# End admin-page-container %>
</body>
</html>