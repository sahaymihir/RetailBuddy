<%# app/views/invoices/show.html.erb %>
<%# Standalone HTML version - without Rails layout %>

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <%= favicon_link_tag "retail_icon.png?v=#{Rails.application.config.assets.version}", type: 'image/png' %>

    <title>Invoice #<%= @invoice.id %></title>

    <%# --- Include CSS/JS --- %>
    <%# Using CDN for Tailwind CSS - Replace if you manage assets differently %>
    <script src="https://cdn.tailwindcss.com"></script>

    <%# Using CDN for Font Awesome (for icons like print/back arrow) - Replace if needed %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* Optional: Add print-specific styles */
        @media print {
            body {
                margin: 0;
                padding: 0;
                background-color: #fff;
                /* Ensure white background for printing */
            }

            .no-print {
                display: none !important;
                /* Hide elements marked with .no-print */
            }

            /* Ensure invoice container takes full width for printing */
            #invoice-container {
                max-width: 100% !important;
                border: none !important;
                box-shadow: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            /* Add any other print adjustments */
        }

        /* Basic body styling if needed */
        body {
            font-family: sans-serif;
            background-color: #f9fafb;
            /* Light gray background for the page */
            padding-top: 1rem;
            padding-bottom: 1rem;
        }

        /* Ensure inline styles for alternating rows work as expected */
        #invoice-items-table tbody tr:nth-child(even) {
            background-color: #f7fafc;
        }

        #invoice-items-table tbody tr:nth-child(odd) {
            background-color: #ffffff;
        }
    </style>
</head>

<body>

    <%# Use a container with slightly more vertical padding and a lighter shadow %>
    <div id="invoice-container" style="padding: 1.5rem 2rem; background-color: #ffffff; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); border-radius: 0.5rem; max-width: 56rem; margin: 2rem auto; border: 1px solid #e2e8f0;">

        <%# Header: Increase bottom margin slightly %>
        <header style="text-align: center; margin-bottom: 2.5rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 1.5rem;">
            <h1 style="font-size: 1.875rem; font-weight: bold; margin-bottom: 0.25rem; color: #1a202c;">Your Store Name</h1>
            <p style="font-size: 0.875rem; color: #4a5568;">123 Main Street, Bengaluru, Karnataka, 560001, India</p>
            <p style="font-size: 0.875rem; color: #4a5568;">Phone: +91 12345 67890 | GSTIN: YOUR_GSTIN_HERE</p>
            <h2 style="font-size: 1.5rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-top: 1rem; color: #2d3748;">Tax Invoice</h2>
        </header>

        <%# Meta Section: Add more bottom margin %>
        <section style="margin-bottom: 2.5rem; display: flex; justify-content: space-between; align-items: flex-start;">
            <div style="width: 50%; padding-right: 1.5rem;">
                <strong style="display: block; color: #4a5568; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.875rem;">Billed To:</strong>
                <div style="font-size: 0.9rem; color: #2d3748; line-height: 1.6;">
                    <% if @invoice.customer %>
                    <%= @invoice.customer.name %><br>
                    <%#= @invoice.customer.address %><br>
                    <%= @invoice.customer.phone %>
                    <% else %>
                    Walk-in Customer
                    <% end %>
                </div>
            </div>
            <div style="width: 45%; padding-left: 1.5rem; text-align: right; font-size: 0.875rem;">
                <div style="margin-bottom: 0.5rem;">
                    <strong style="color: #4a5568; display: inline-block; min-width: 70px;">Invoice #:</strong> <span style="color: #2d3748;"><%= @invoice.id %></span>
                </div>
                <div style="margin-bottom: 0.5rem;">
                    <strong style="color: #4a5568; display: inline-block; min-width: 70px;">Date:</strong> <span style="color: #2d3748;"><%= @invoice.invoice_date.strftime("%d-%b-%Y %I:%M %p") %></span>
                </div>
                <div>
                    <strong style="color: #4a5568; display: inline-block; min-width: 70px;">Status:</strong>
                    <%# Applying Tailwind classes directly for status background/text color %>
                    <span style="text-transform: uppercase; font-weight: 500; padding: 0.15rem 0.4rem; border-radius: 0.25rem; font-size: 0.75rem;" class="<%= @invoice.status == 'paid' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800' %>">
                        <%= @invoice.status.humanize %>
                    </span>
                </div>
            </div>
        </section>

        <%# Items Section: Improve table styling %>
        <section style="margin-bottom: 2.5rem;">
            <table id="invoice-items-table" style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">
                <thead>
                    <tr style="background-color: #edf2f7; border-bottom: 2px solid #cbd5e0; color: #2d3748; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.025em;">
                        <th style="padding: 0.75rem 0.5rem; text-align: left;">#</th>
                        <th style="padding: 0.75rem 0.5rem; text-align: left;">Item</th>
                        <th style="padding: 0.75rem 0.5rem; text-align: right;">Qty</th>
                        <th style="padding: 0.75rem 0.5rem; text-align: right;">Unit Price</th>
                        <th style="padding: 0.75rem 0.5rem; text-align: right;">Subtotal</th>
                        <th style="padding: 0.75rem 0.5rem; text-align: right;">Tax Rate</th>
                        <th style="padding: 0.75rem 0.5rem; text-align: right;">Tax Amt</th>
                        <th style="padding: 0.75rem 0.5rem; text-align: right;">Line Total</th>
                    </tr>
                </thead>
                <tbody>
                    <% @invoice.invoice_lines.each_with_index do |line, index| %>
                    <tr style="border-bottom: 1px solid #e2e8f0;"> <%# Alternating background handled by style tag in head %>
                        <td style="padding: 0.6rem 0.5rem; vertical-align: top;"><%= index + 1 %></td>
                        <td style="padding: 0.6rem 0.5rem; vertical-align: top;"><%= line.product.name rescue 'N/A' %></td>
                        <td style="padding: 0.6rem 0.5rem; text-align: right; vertical-align: top;"><%= line.quantity %></td>
                        <td style="padding: 0.6rem 0.5rem; text-align: right; vertical-align: top;"><%= number_to_currency(line.unit_price, unit: "₹", format: "%u %n") %></td>
                        <td style="padding: 0.6rem 0.5rem; text-align: right; vertical-align: top;"><%= number_to_currency(line.line_subtotal, unit: "₹", format: "%u %n") %></td>
                        <td style="padding: 0.6rem 0.5rem; text-align: right; vertical-align: top;"><%= number_to_percentage(line.product.applicable_tax_rate, precision: 2) rescue 'N/A' %></td>
                        <td style="padding: 0.6rem 0.5rem; text-align: right; vertical-align: top;"><%= number_to_currency(line.line_tax, unit: "₹", format: "%u %n") %></td>
                        <td style="padding: 0.6rem 0.5rem; text-align: right; font-weight: 500; vertical-align: top;"><%= number_to_currency(line.line_total, unit: "₹", format: "%u %n") %></td>
                    </tr>
                    <% end %>
                </tbody>
            </table>
        </section>

        <%# Summary Section: Improve alignment and emphasis %>
        <section style="margin-bottom: 2.5rem; display: flex; justify-content: space-between; align-items: flex-start; padding-top: 1.5rem; border-top: 1px solid #e2e8f0;">
            <div style="width: 50%; padding-right: 1.5rem; font-size: 0.875rem; color: #4a5568;">
                <% if @invoice.payments.any? %>
                <strong style="font-weight:600; display: block; margin-bottom: 0.3rem;">Payment Method:</strong>
                <span><%= @invoice.payments.first.payment_method || 'N/A' %></span>
                <% else %>
                <strong style="font-weight:600;">Payment Method:</strong> <span>Not Recorded</span>
                <% end %>
            </div>

            <div style="width: 45%;">
                <table style="width: 100%; font-size: 0.9rem; text-align: right;">
                    <tbody>
                        <tr>
                            <td style="padding: 0.3rem; color: #4a5568;">Subtotal:</td>
                            <td style="padding: 0.3rem; font-weight: 500; color: #2d3748;"><%= number_to_currency(@invoice.subtotal, unit: "₹", format: "%u %n") %></td>
                        </tr>
                        <tr>
                            <td style="padding: 0.3rem; color: #4a5568;">Total Tax:</td>
                            <td style="padding: 0.3rem; font-weight: 500; color: #2d3748;"><%= number_to_currency(@invoice.calculated_total_tax, unit: "₹", format: "%u %n") %></td>
                        </tr>
                        <tr style="border-top: 2px solid #a0aec0; border-bottom: 2px solid #a0aec0;">
                            <td style="padding: 0.6rem 0.3rem; font-size: 1.1rem; font-weight: bold; color: #1a202c;">Grand Total:</td>
                            <td style="padding: 0.6rem 0.3rem; font-size: 1.1rem; font-weight: bold; color: #1a202c;"><%= number_to_currency(@invoice.calculated_total_amount, unit: "₹", format: "%u %n") %></td>
                        </tr>
                        <%# Payment Status Section %>
                        <% paid_amount = @invoice.payments.sum(:amount) rescue 0 %>
                        <% if paid_amount > 0 %>
                        <tr>
                            <td style="padding-top: 0.8rem; padding-bottom: 0.3rem; color: #4a5568;">Amount Paid:</td>
                            <td style="padding-top: 0.8rem; padding-bottom: 0.3rem; font-weight: 500; color: #38a169;"><%= number_to_currency(paid_amount, unit: "₹", format: "%u %n") %></td>
                        </tr>
                        <% balance_due = @invoice.calculated_total_amount - paid_amount %>
                        <% if balance_due > 0.01 %>
                        <tr>
                            <td style="padding-bottom: 0.3rem; color: #e53e3e; font-weight: 600;">Balance Due:</td>
                            <td style="padding-bottom: 0.3rem; color: #e53e3e; font-weight: 600;"><%= number_to_currency(balance_due, unit: "₹", format: "%u %n") %></td>
                        </tr>
                        <% end %>
                        <% end %>
                    </tbody>
                </table>
            </div>
        </section>

        <footer style="text-align: center; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e2e8f0; font-size: 0.75rem; color: #718096;">
            <p>Thank you for your business!</p>
            <p>Visit us again at Your Store Name | www.yourwebsite.com</p>
        </footer>

        <%# Buttons Section - Hidden during printing by the .no-print class and @media print style %>
        <div style="margin-top: 2.5rem; text-align: center;" class="no-print">
            <%= link_to '<i class="fas fa-print mr-1"></i> Print Invoice'.html_safe, printable_invoice_path(@invoice), target: '_blank', class: 'inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500' %>
            <%= link_to '<i class="fas fa-arrow-left mr-1"></i> Back to Invoices'.html_safe, invoices_path, class: 'ml-4 inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500' %>
        </div>

    </div> <%# End of #invoice-container %>

</body>

</html>