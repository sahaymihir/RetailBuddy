<%# app/views/customers/index.html.erb %>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetailBuddy - Customer Management</title>

    <%# Link necessary stylesheets directly (keep if not using layouts) %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "dashboard", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "customers", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "custom", "data-turbo-track": "reload" %>

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= javascript_importmap_tags %>

    <%# External Fonts/Icons %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <%# --- ADDED: Embedded CSS for title link --- %>
    <style>
      .customers-title-link,
      .customers-title-link:hover {
        text-decoration: none; /* Remove underline */
        color: inherit; /* Make link color match surrounding text (the h1) */
      }
    </style>
    <%# --- END Embedded CSS --- %>

</head>

<body>

    <div class="customers-page-container">

        <div class="customers-header">
            <%# Corrected success_path_path to success_path %>
            <%= link_to success_path_path, class: "customers-title-link" do %>
            <h1 class="customers-title">Customer Management</h1>
            <% end %>
            <div class="customers-actions">
                <%= link_to "Add New Customer", new_customer_path, class: "action-btn primary" %>
            </div>
        </div>

        <%# Search Form %>
        <%= form_with(url: customers_path, method: :get, local: true, data: { turbo_frame: "_top" }) do |form| %>
        <div class="customer-controls">
            <div class="input-group">
                <div class="input-field">
                    <i class="fas fa-search"></i>
                    <%= form.text_field :search_query, placeholder: "Search Name, Email, or Phone...", class: "w-full", value: params[:search_query] %>
                </div>
            </div>
            <%= form.button "Search", class: "action-btn", type: "submit" %>
        </div>
        <% end %>

        <div class="customers-table-container">
            <table class="customers-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Address</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% if defined?(@customers) && @customers.present? %>
                    <% @customers.each do |customer| %>
                    <tr>
                        <td><%= customer.name || "N/A" %></td>
                        <td><%= customer.email || "N/A" %></td>
                        <td><%= customer.phone || "N/A" %></td>
                        <td class="customer-address"><%= customer.address || "N/A" %></td>
                        <td class="table-actions">
                            <%= link_to '<i class="fas fa-edit"></i>'.html_safe, edit_customer_path(customer) %>
                            <%= button_to '<i class="fas fa-trash"></i>'.html_safe, customer_path(customer), method: :delete, class: 'delete-btn', form: { data: { turbo_confirm: 'Are you sure you want to delete this customer?' } } %>
                        </td>
                    </tr>
                    <% end %>
                    <% else %>
                    <tr>
                        <td colspan="5" class="no-customers-message">No customers found. Add a new customer to get started.</td>
                    </tr>
                    <% end %>
                </tbody>
            </table>
        </div>

    </div> <%# End customers-page-container %>

</body>

</html>